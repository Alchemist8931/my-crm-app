<!-- /pages/modal1.html -->
<button class="close-modal" onclick="closeModal()">×</button>
<div class="modal111-content" style="justify-content: flex-start;">
  <h2 class="modal1-title">ELABORATION SALES</h2>
  <p class="modal1-subtitle">проекты в работе</p>
  <button id="add-project-button" style="margin-top: -4.2vw; padding: 0.5vw 1vw; font-size: 0.4vw; cursor: pointer;">
    Добавить проект
  </button>

  <div id="modalBottom" class="modalVNUT" style="top: 4.5vw; left: 6vw; right: 2vw; height: calc(100vh - 6.4vw); width: 99%;">
    <div class="modalVNUT-content" id="projects-container">
      <!-- Контейнеры проектов будут динамически добавляться здесь -->
    </div>
  </div>
</div>

<!-- Модальное окно редактирования -->
<div id="editModal" class="edit-modal hidden">
  <div class="edit-modal-content">
    <button class="close-edit-modal" onclick="closeEditModal()">×</button>
    <h3>Редактирование проекта</h3>
    <form id="edit-form">
  <!-- Поля редактирования -->

  <!-- Название проекта -->
  <label for="edit-project-name">Название проекта</label>
  <input type="text" id="edit-project-name" placeholder="Введите название проекта" required />

  <!-- Статус проекта -->
  <label for="edit-status">Статус</label>
  <input type="text" id="edit-status" placeholder="Введите статус проекта" required />

  <!-- Сумма контракта -->
  <label for="edit-contract-amount">Сумма контракта</label>
  <input type="number" id="edit-contract-amount" step="0.01" placeholder="Введите сумму контракта" required />

  <!-- Стоимость контракта -->
  <label for="edit-contract-cost">Стоимость контракта</label>
  <input type="number" id="edit-contract-cost" step="0.01" placeholder="Введите стоимость контракта" />

  <!-- Прибыль -->
  <label for="edit-contract-profit">Прибыль</label>
  <input type="number" id="edit-contract-profit" step="0.01" placeholder="Введите прибыль" />

  <!-- Процент прибыли -->
  <label for="edit-profit-percentage">Процент прибыли</label>
  <input type="number" id="edit-profit-percentage" step="0.01" placeholder="Введите процент прибыли" />

  <!-- Компания-продавец -->
  <label for="edit-company-seller">Компания-продавец</label>
  <input type="text" id="edit-company-seller" placeholder="Введите название компании-продавца" />

  <!-- ИНН продавца -->
  <label for="edit-tin-seller">ИНН продавца</label>
  <input type="text" id="edit-tin-seller" placeholder="Введите ИНН продавца" />

  <!-- Компания-покупатель -->
  <label for="edit-buyer-company">Компания-покупатель</label>
  <input type="text" id="edit-buyer-company" placeholder="Введите название компании-покупателя" />

  <!-- ИНН покупателя -->
  <label for="edit-tin-buyer">ИНН покупателя</label>
  <input type="text" id="edit-tin-buyer" placeholder="Введите ИНН покупателя" />

  <!-- Кнопка для сохранения изменений -->
  <button type="button" id="save-button">Сохранить</button>
</form>

  </div>
</div>


<style>
.close-modal {
    position: absolute;
    top: 0.5vw;
    right: 0.5vw;
    background: none;
    border: none;
    font-size: 1vw;
    cursor: pointer;
    color: var(--white-color2);
  }

  .close-modal:hover {
    color: #393E41;
  }

  .modal111-content {
    font-family: "Comfortaa", sans-serif;
    color: var(--white-color2);
    background-color: none; /* Белый фон для контента */
    border-radius: var(--borderRadius);
    height: calc(100vh - (var(--spacer)*2));
    width: calc(100vw - (var(--spacer)*6));
    box-sizing: border-box;
    position: relative;
    pading: 1vw
  }

  /* Заголовок */
.modal1-title {
  color: var(--white-color2);
  font-size: 0.7vw;
  margin-top: 1vw;
  margin-left: 1vw;
  display: flex
}

/* Подзаголовок */
.modal1-subtitle {
  color: var(--white-color2);
  font-size: 0.45vw;
  margin-top: 0.2vw;
  margin-left: 1vw;
  display: flex
}

  /* Если необходимо выровнять h2 и p внутри flex-контейнера, можно добавить */
.modal1-content h2,
.modal1-content p {
  align-self: flex-start;
  display: flex
}
  
  
  
  /* _______________________________  стили модального окна с прокруткой / скроллом */
  
  /* Модальное окно с прокруткой */
.modalVNUT {
  display: flex;
  position: fixed;
  background: none;
  padding: 0vw;
  border-radius: 0.4vw;
  border: 0px solid rgba(255, 255, 255, 0.18);
  color: black;
  z-index: 1000;
  overflow: hidden; /* Отключаем общий скролл */
  box-sizing: border-box;
}

/* Внутренний контейнер с прокруткой */
.modalVNUT-content {
  padding: 0.5vh 2vh 0vw 0vw; /* Отступы внутри модального окна */
  height: 100%;
  width: 100%;
  overflow-y: auto; /* Включаем вертикальную прокрутку */
  box-sizing: border-box;
}

/* Стилизация скроллбара */
.modalVNUT-content::-webkit-scrollbar {
  width: 4px; /* Ширина скроллбара */
  background-color: var(--scrollbar-color);
}

.modalVNUT-content::-webkit-scrollbar-thumb {
  background-color: var(--scrollbar-thumb-color); /* Цвет ползунка */
  border-radius: 10px; /* Скругление */
}

.modalVNUT-content::-webkit-scrollbar-track {
  background-color: var(--scrollbar-color);
}
  
  /* Внутренний контейнер с прокруткой */
.modalVNUT-content {
  padding: 0.5vh 2vh 0vw 0vw; /* Отступы внутри модального окна */
  height: 100%;
  width: 100%;
  overflow-y: auto; /* Включаем вертикальную прокрутку */
  box-sizing: border-box;
}

/* Стилизация скроллбара */
.modalVNUT-content::-webkit-scrollbar {
  width: 4px; /* Ширина скроллбара */
  background-color: var(--scrollbar-color);
}

.modalVNUT-content::-webkit-scrollbar-thumb {
  background-color: var(--scrollbar-thumb-color); /* Цвет ползунка */
  border-radius: 10px; /* Скругление */
}

.modalVNUT-content::-webkit-scrollbar-track {
  background-color: var(--scrollbar-color);
}



  /* _____________________________________________________________________    Контейнеры внутри модального окна */

  .modal1-container {
    display: flex;
    align-items: center; /* Центрирование по вертикали */
    padding: 0.4vw;
    border-radius: var(--borderRadius);
    color: var(--white-color2);
    z-index: 1100;
    box-sizing: border-box;
    background: rgba(255, 255, 255, 0.05);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.18);
    width: 100%; /* Ширина контейнера остается неизменной */
    height: 2.1vw;
    transform: scale(0.86); /* Уменьшаем все элементы внутри контейнера на 30% */
    transform-origin: top left; /* Сохраняем ширину контейнера */
  }

  .modal1-container:hover,
  .modal1-container:focus {
    border: 1px solid var(--white-color2);
  }

  /* Отступы только между контейнерами */
  .modal1-container:not(:last-child) {
    margin-bottom: 0.5vw; /* Отступ снизу только между контейнерами */
  }

  /* Иконки */
  .modal1-icon {
    color: rgba(255, 255, 255, 0.6);
    font-size: 1.4vw; /* Уменьшено на 30% */
    margin-right: 0.175vw; /* Уменьшено на 30% */
    cursor: pointer;
    display: flex;
    align-items: center; /* Центрирование иконок по вертикали */
  }

  .modal1-icon:hover {
    color: var(--white-color2);
    transform: scale(0.7 * 1.1); /* Увеличение иконки при наведении с учетом масштаба */
  }

  .modal1-icon:active {
    transform: scale(0.7 * 0.92); /* Сжатие иконки при клике с учетом масштаба */
  }

  /* Input группы */
  .modal1-input-group {
    position: relative;
    font-family: "Comfortaa", sans-serif;
  }

  .modal1-input-group.left {
    margin-left: 1.54vw; /* Уменьшено на 30% от 2.2vw */
  }

  .modal1-input-group.right {
    margin-left: 0.28vw; /* Уменьшено на 30% от 0.4vw */
  }

  .modal1-input-group label {
    background: none;
    color: rgba(255, 255, 255, 0.6);
    position: absolute;
    top: 0.61vw; /* Уменьшено на 30% от 0.86vw */
    left: 0.28vw; /* Уменьшено на 30% от 0.4vw */
    transform: translateY(-50%);
    text-transform: uppercase;
    font-weight: 700;
    pointer-events: none;
    font-size: 0.42vw; /* Уменьшено на 30% от 0.6vw */
    transition: all 0.3s;
  }

  .modal1-input-group .modal1-input {
    padding: 0.28vw 0.28vw; /* Уменьшено на 30% от 0.4vw */
    width: 100%;
    border: 1px solid rgba(255, 255, 255, 0.18);
    outline: none;
    color: var(--white-color2);
    font-size: 0.49vw; /* Уменьшено на 30% от 0.7vw */
    font-family: inherit;
    background-color: transparent;
    border-radius: 7px; /* Уменьшено на 30% от 10px → 7px */
  }

  .modal1-input-group .modal1-input:hover,
  .modal1-input-group .modal1-input:focus {
    border: 1px solid var(--white-color2);
  }

  .modal1-input-group .modal1-input:focus + label,
  .modal1-input-group .modal1-input:not(:placeholder-shown) + label {
    top: -0.06vw; /* Уменьшено на 30% от -0.5vw */
    font-size: 0.28vw; /* Уменьшено на 30% от 0.4vw */
    padding: 0 0.28vw; /* Уменьшено на 30% от 0.4vw */
    background: rgba(0, 0, 0, 0.5);
    border-radius: 7px; /* Уменьшено на 30% от 10px → 7px */
    color: var(--white-color2);
  }

  /* Input заголовок без границ */
  .modal1-input-TYPE1 {
    position: relative;
    font-family: "Comfortaa", sans-serif;
    width: 1.4vw; /* Уменьшено на 30% от 2vw */
    border: none;
    outline: none;
    color: rgba(255, 255, 255, 0.6);
    background-color: transparent;
    margin-top: 0.7vw; /* Уменьшено на 30% от 1vw */
  }

  /* Иконки внутри контейнера */
  .modal1-icon {
    color: rgba(255, 255, 255, 0.6);
    font-size: 1.4vw; /* Уменьшено на 30% от 2vw */
    margin-right: 0.175vw; /* Уменьшено на 30% от 0.25vw */
    cursor: pointer;
    display: flex;
    align-items: center; /* Центрирование иконок по вертикали */
  }

  .modal1-icon:hover {
    color: var(--white-color2);
    transform: scale(1.1); /* Увеличение иконки при наведении */
  }

  .modal1-icon:active {
    transform: scale(0.92); /* Сжатие иконки при клике */
  }

    /* Дополнительные стили для кнопки добавления проекта */
  #add-project-button {
    background-color: var(--white-color2);
    color: var(--black-color);
    border: none;
    border-radius: 5px;
    transition: background-color 0.3s;
  }

  #add-project-button:hover {
    background-color: var(--white-color1);
  }



  
  /* Стили для модального окна редактирования */
.edit-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(15px);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1100;
}

.edit-modal.hidden {
  display: none;
}

.edit-modal-content {
  background: white;
  padding: 2rem;
  border-radius: 10px;
  width: 50%;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
}

.close-edit-modal {
  position: absolute;
  top: 10px;
  right: 10px;
  background: none;
  border: none;
  font-size: 1.5rem;
  cursor: pointer;
}
  
  
</style>

<script type="module">
  const supabase = window.supabase;

  document.getElementById('save-button').addEventListener('click', saveProject);
  const projectsContainer = document.getElementById('projects-container');
  const addProjectButton = document.getElementById('add-project-button');
  const editModal = document.getElementById('editModal');
  const editForm = document.getElementById('edit-form');

  let currentEditingProject = null;

  // Генерация уникального project_id
  const generateProjectID = () => 'proj_' + Math.random().toString(36).substr(2, 9);

  // Создание HTML-контейнера проекта
  function createProjectContainer(project) {
    console.log('Входящие данные в createProjectContainer:', project);

    if (!project || !project.project_id) {
        console.error('Invalid project data passed to createProjectContainer:', project);
        return null;
    }

    const uniqueSuffix = Math.random().toString(36).substr(2, 5); // Дополнительный уникальный суффикс

    const container = document.createElement('div');
    container.classList.add('modal1-container');
    container.dataset.id = project.project_id;

    container.innerHTML = `
    <span class="modal1-icon" data-action="delete" data-id="${project.project_id}">
      <i class="material-symbols-outlined">delete</i>
    </span>
    <span class="modal1-icon" data-action="edit" data-id="${project.project_id}">
      <i class="material-symbols-outlined">edit</i>
    </span>

    <div class="modal1-input-group left">
      <input type="text" class="modal1-input" id="project-id-${project.project_id}-${uniqueSuffix}" value="${project.project_id}" placeholder=" " data-field="project_id" readonly />
      <label for="project-id-${project.project_id}-${uniqueSuffix}">Project ID</label>
    </div>

    <div class="modal1-input-group right">
      <input type="text" class="modal1-input" id="project-name-${project.project_id}-${uniqueSuffix}" value="${project.project_name}" placeholder=" " data-field="project_name" readonly />
      <label for="project-name-${project.project_id}-${uniqueSuffix}">Project Name</label>
    </div>

    <div class="modal1-input-group right">
      <input type="text" class="modal1-input" id="status-${project.project_id}-${uniqueSuffix}" value="${project.status || ''}" placeholder=" " data-field="status" readonly />
      <label for="status-${project.project_id}-${uniqueSuffix}">Status</label>
    </div>

    <div class="modal1-input-group left">
      <input type="number" step="0.01" class="modal1-input" id="contract-amount-${project.project_id}-${uniqueSuffix}" value="${project.contract_amount || ''}" placeholder=" " data-field="contract_amount" readonly />
      <label for="contract-amount-${project.project_id}-${uniqueSuffix}">Contract Amount</label>
    </div>

    <div class="modal1-input-group right">
      <input type="number" step="0.01" class="modal1-input" id="contract-costs-${project.project_id}-${uniqueSuffix}" value="${project.contract_costs || ''}" placeholder=" " data-field="contract_costs" readonly />
      <label for="contract-costs-${project.project_id}-${uniqueSuffix}">Contract Costs</label>
    </div>

    <div class="modal1-input-group right">
      <input type="number" step="0.01" class="modal1-input" id="contract-profit-${project.project_id}-${uniqueSuffix}" value="${project.contract_profit || ''}" placeholder=" " data-field="contract_profit" readonly />
      <label for="contract-profit-${project.project_id}-${uniqueSuffix}">Contract Profit</label>
    </div>

    <div class="modal1-input-group right">
      <input type="number" step="0.01" class="modal1-input" id="profit-percentage-${project.project_id}-${uniqueSuffix}" value="${project.profit_percentage || ''}" placeholder=" " data-field="profit_percentage" readonly />
      <label for="profit-percentage-${project.project_id}-${uniqueSuffix}">Profit %</label>
    </div>

    <div class="modal1-input-group left">
      <input type="text" class="modal1-input" id="company-seller-${project.project_id}-${uniqueSuffix}" value="${project.company_seller || ''}" placeholder=" " data-field="company_seller" readonly />
      <label for="company-seller-${project.project_id}-${uniqueSuffix}">Company Seller</label>
    </div>

    <div class="modal1-input-group right">
      <input type="text" class="modal1-input" id="tin-seller-${project.project_id}-${uniqueSuffix}" value="${project.tin_seller || ''}" placeholder=" " data-field="tin_seller" readonly />
      <label for="tin-seller-${project.project_id}-${uniqueSuffix}">TIN Seller</label>
    </div>

    <div class="modal1-input-group left">
      <input type="text" class="modal1-input" id="buyer-company-${project.project_id}-${uniqueSuffix}" value="${project.buyer_company || ''}" placeholder=" " data-field="buyer_company" readonly />
      <label for="buyer-company-${project.project_id}-${uniqueSuffix}">Buyer Company</label>
    </div>

    <div class="modal1-input-group right">
      <input type="text" class="modal1-input" id="tin-buyer-${project.project_id}-${uniqueSuffix}" value="${project.tin_buyer || ''}" placeholder=" " data-field="tin_buyer" readonly />
      <label for="tin-buyer-${project.project_id}-${uniqueSuffix}">TIN Buyer</label>
    </div>
  `;

    return container;
}

  // Загрузка всех проектов
  async function loadProjects() {
    const { data, error } = await supabase.from('projects').select('*');
    if (error) {
        console.error('Ошибка загрузки проектов:', error);
        return; // Возвращаемся, если есть ошибка
    }

    projectsContainer.innerHTML = ''; // Очищаем контейнер

    const fragment = document.createDocumentFragment(); // Создаем фрагмент для минимизации операций с DOM
    data.forEach((project) => {
        const projectElement = createProjectContainer(project);
        if (projectElement) {
            fragment.appendChild(projectElement); // Добавляем только корректные элементы
        } else {
            console.warn(`Контейнер для проекта ${project.project_id} не был создан.`);
        }
    });

    projectsContainer.appendChild(fragment); // Добавляем фрагмент в DOM один раз
}


  // Добавление нового проекта
  async function addNewProject() {
    const newProject = {
        project_id: generateProjectID(),
        project_name: 'Новый проект',
        status: 'Новый',
        contract_amount: 0.00,
        contract_costs: 0.00,
        contract_profit: 0.00,
        profit_percentage: 0.00,
        company_seller: '',
        tin_seller: '',
        buyer_company: '',
        tin_buyer: '',
    };

    console.log('Создание нового проекта:', newProject);

    const { data, error } = await supabase
        .from('projects')
        .insert([newProject])
        .select()
        .single();

    if (error) {
        console.error('Ошибка добавления проекта в базу данных:', error);
        return;
    }

    console.log('Данные проекта, возвращенные из Supabase:', data);
}

    console.log('Данные проекта, возвращенные из Supabase:', data);

    // Проверяем, что данные успешно возвращены
    if (!data) {
        console.warn('Supabase вернул пустые данные.');
        return;
    }

    // Создаем DOM-элемент контейнера для нового проекта
    const newProjectElement = createProjectContainer(data);
    if (newProjectElement) {
        projectsContainer.appendChild(newProjectElement); // Добавляем контейнер в DOM
    }
}




  // Удаление проекта
  async function deleteProject(projectId) {
    const { error } = await supabase.from('projects').delete().eq('project_id', projectId);
    if (error) {
      console.error('Ошибка удаления проекта:', error);
      return;
    }

    const projectElement = projectsContainer.querySelector(`[data-id="${projectId}"]`);
    if (projectElement && projectsContainer.contains(projectElement)) {
      projectsContainer.removeChild(projectElement);
    } else {
      console.error(`Project element with project_id ${projectId} not found in projectsContainer.`);
    }
  }

  // Открытие модального окна редактирования
  function openEditModal(projectId) {
    const projectElement = projectsContainer.querySelector(`[data-id="${projectId}"]`);
    if (!projectElement) {
      console.error(`Project with project_id ${projectId} not found.`);
      return;
    }

    // Получаем данные из data-атрибутов
    const project = {
      project_id: projectId,
      project_name: projectElement.dataset.projectName,
      status: projectElement.dataset.status,
      contract_amount: projectElement.dataset.contractAmount,
      contract_costs: projectElement.dataset.contractCosts,
      contract_profit: projectElement.dataset.contractProfit,
      profit_percentage: projectElement.dataset.profitPercentage,
      company_seller: projectElement.dataset.companySeller,
      tin_seller: projectElement.dataset.tinSeller,
      buyer_company: projectElement.dataset.buyerCompany,
      tin_buyer: projectElement.dataset.tinBuyer,
    };

    currentEditingProject = project;

    // Заполняем форму
    editForm.elements['edit-project-name'].value = project.project_name;
    editForm.elements['edit-status'].value = project.status;
    editForm.elements['edit-contract-amount'].value = project.contract_amount;
    editForm.elements['edit-contract-cost'].value = project.contract_costs;
    editForm.elements['edit-contract-profit'].value = project.contract_profit;
    editForm.elements['edit-profit-percentage'].value = project.profit_percentage;
    editForm.elements['edit-company-seller'].value = project.company_seller;
    editForm.elements['edit-tin-seller'].value = project.tin_seller;
    editForm.elements['edit-buyer-company'].value = project.buyer_company;
    editForm.elements['edit-tin-buyer'].value = project.tin_buyer;

    // Показываем модальное окно
    editModal.classList.remove('hidden');
  }

  // Закрытие модального окна редактирования
  function closeEditModal() {
    editModal.classList.add('hidden');
    currentEditingProject = null;
  }

  // Сохранение изменений в проекте
  async function saveProject() {
    if (!currentEditingProject) {
        console.error('Нет текущего редактируемого проекта.');
        return;
    }

    const updatedProject = {
        project_name: editForm.elements['edit-project-name'].value || '',
        status: editForm.elements['edit-status'].value || '',
        contract_amount: parseFloat(editForm.elements['edit-contract-amount'].value) || 0.00,
        contract_costs: parseFloat(editForm.elements['edit-contract-cost'].value) || 0.00,
        contract_profit: parseFloat(editForm.elements['edit-contract-profit'].value) || 0.00,
        profit_percentage: parseFloat(editForm.elements['edit-profit-percentage'].value) || 0.00,
        company_seller: editForm.elements['edit-company-seller'].value || '',
        tin_seller: editForm.elements['edit-tin-seller'].value || '',
        buyer_company: editForm.elements['edit-buyer-company'].value || '',
        tin_buyer: editForm.elements['edit-tin-buyer'].value || '',
    };

    const { data, error } = await supabase
        .from('projects')
        .update(updatedProject)
        .eq('project_id', currentEditingProject.project_id)
        .single();

    if (error) {
        console.error('Ошибка сохранения проекта:', error);
        return;
    }

    // Обновляем проект в DOM
    const projectElement = projectsContainer.querySelector(`[data-id="${currentEditingProject.project_id}"]`);
    if (projectElement) {
        projectElement.dataset.projectName = data.project_name || '';
        projectElement.dataset.status = data.status || '';
      projectElement.dataset.contractAmount = data.contract_amount || 0;
      projectElement.dataset.contractCosts = data.contract_costs || 0;
      projectElement.dataset.contractProfit = data.contract_profit || 0;
      projectElement.dataset.profitPercentage = data.profit_percentage || 0;
      projectElement.dataset.companySeller = data.company_seller || '';
      projectElement.dataset.tinSeller = data.tin_seller || '';
      projectElement.dataset.buyerCompany = data.buyer_company || '';
      projectElement.dataset.tinBuyer = data.tin_buyer || '';

      // Обновляем отображаемое название
      const p = projectElement.querySelector('p');
      if (p) {
        p.textContent = data.project_name || 'Без названия';
      }
    }

    // Закрываем модальное окно
    closeEditModal();
  }

  // Подписка на изменения в таблице projects (реальное время)
  function setupRealtime() {
    const channel = supabase
        .channel('realtime_projects')
        .on(
            'postgres_changes',
            { event: '*', schema: 'public', table: 'projects' },
            (payload) => {
                const projectId = payload.new?.project_id || payload.old?.project_id;
                if (!projectId) return;

                if (payload.eventType === 'INSERT') {
                    const projectElement = createProjectContainer(payload.new);
                    if (projectElement) {
                        projectsContainer.appendChild(projectElement);
                    }
                }
            }
        )
        .subscribe();
}


  // Обработка кликов на кнопке "Сохранить" в форме редактирования
  editForm.addEventListener('submit', (event) => {
    event.preventDefault();
    saveProject();
  });

  // Обработка кликов на кнопке "Сохранить" (альтернативный путь)
  editForm.querySelector('button[type="button"]').addEventListener('click', saveProject);

  // Обработка кликов на кнопке "Добавить проект"
  if (addProjectButton) {
    addProjectButton.addEventListener('click', addNewProject);
  }

  // Обработка кликов на иконках в контейнерах
  projectsContainer.addEventListener('click', (event) => {
    const icon = event.target.closest('.modal1-icon');
    if (!icon) return;

    const action = icon.dataset.action;
    const projectId = icon.dataset.id;

    if (action === 'delete') {
      deleteProject(projectId);
    } else if (action === 'edit') {
      openEditModal(projectId);
    }
  });

  // Запуск
  loadProjects();
  setupRealtime();
</script>
